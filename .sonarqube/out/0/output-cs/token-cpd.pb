³
FF:\Source\TestJenkins\daiproject\JwtDemo\Controllers\AuthController.cs
	namespace 	
JwtDemo
 
. 
Controllers 
{ 
[ 
Route 

(
 
$str 
) 
] 
[ 
ApiController 
] 
public 

class 
AuthController 
:  !
ControllerBase" 0
{ 
[ 	
HttpPost	 
( 
$str 
) 
] 
public 
ActionResult 
GetToken $
($ %
)% &
{ 	
string 
securityKey 
=  
$str! x
;x y
var  
symmetricSecurityKey $
=% &
new' * 
SymmetricSecurityKey+ ?
(? @
Encoding@ H
.H I
UTF8I M
.M N
GetBytesN V
(V W
securityKeyW b
)b c
)c d
;d e
var 
signingCredentials "
=# $
new% (
SigningCredentials) ;
(; < 
symmetricSecurityKey< P
,P Q
SecurityAlgorithmsR d
.d e
HmacSha256Signaturee x
)x y
;y z
var 
claims 
= 
new  
List! %
<% &
Claim& +
>+ ,
(, -
)- .
;. /
claims 
. 
Add 
( 
new 
Claim  
(  !

ClaimTypes! +
.+ ,
Role, 0
,0 1
$str2 A
)A B
)B C
;C D
claims   
.   
Add   
(   
new   
Claim    
(    !

ClaimTypes  ! +
.  + ,
Role  , 0
,  0 1
$str  2 :
)  : ;
)  ; <
;  < =
claims!! 
.!! 
Add!! 
(!! 
new!! 
Claim!!  
(!!  !
$str!!! 3
,!!3 4
$str!!5 G
)!!G H
)!!H I
;!!I J
claims"" 
."" 
Add"" 
("" 
new"" 
Claim""  
(""  !
$str""! %
,""% &
$str""' ,
)"", -
)""- .
;"". /
var&& 
token&& 
=&& 
new&& 
JwtSecurityToken&& ,
(&&, -
issuer'' 
:'' 
$str'' &
,''& '
audience(( 
:(( 
$str(( '
,((' (
expires)) 
:)) 
DateTime)) %
.))% &
Now))& )
.))) *
AddHours))* 2
())2 3
$num))3 4
)))4 5
,))5 6
signingCredentials** &
:**& '
signingCredentials**( :
,++ 
claims++ 
:++ 
claims++ $
),, 
;,, 
return// 
Ok// 
(// 
new// #
JwtSecurityTokenHandler// 1
(//1 2
)//2 3
.//3 4

WriteToken//4 >
(//> ?
token//? D
)//D E
)//E F
;//F G
}00 	
}11 
}22 ¨
HF:\Source\TestJenkins\daiproject\JwtDemo\Controllers\ValuesController.cs
	namespace 	
JwtDemo
 
. 
Controllers 
{		 
[

 
Route

 

(


 
$str

 
)

 
]

 
[ 
ApiController 
] 
[ 
	Authorize 
( 
Roles 
= 
$str &
)& '
]' (
public 

class 
ValuesController !
:" #
ControllerBase$ 2
{ 
[ 	
HttpGet	 
( 
$str 
) 
] 
public 
ActionResult 
< 
string "
>" #
GetMyId$ +
(+ ,
), -
{ 	
var 
idClaim 
= 
User 
. 
Claims %
.% &
FirstOrDefault& 4
(4 5
x5 6
=>7 9
x: ;
.; <
Type< @
.@ A
EqualsA G
(G H
$strH L
,L M
StringComparisonN ^
.^ _&
InvariantCultureIgnoreCase_ y
)y z
)z {
;{ |
if 
( 
idClaim 
!= 
null 
) 
{ 
return 
Ok 
( 
$" 
This is your Id:  -
{- .
idClaim. 5
.5 6
Value6 ;
}; <
"< =
)= >
;> ?
} 
return 

BadRequest 
( 
$str (
)( )
;) *
} 	
[ 	
HttpGet	 
] 
public 
ActionResult 
< 
IEnumerable '
<' (
string( .
>. /
>/ 0
Get1 4
(4 5
)5 6
{ 	
return 
new 
string 
[ 
] 
{  !
$str" *
,* +
$str, 4
}5 6
;6 7
} 	
["" 	
HttpGet""	 
("" 
$str"" 
)"" 
]"" 
public## 
ActionResult## 
<## 
string## "
>##" #
Get##$ '
(##' (
int##( +
id##, .
)##. /
{$$ 	
return%% 
$str%% 
;%% 
}&& 	
[)) 	
HttpPost))	 
])) 
public** 
void** 
Post** 
(** 
[** 
FromBody** "
]**" #
string**$ *
value**+ 0
)**0 1
{++ 	
},, 	
[// 	
HttpPut//	 
(// 
$str// 
)// 
]// 
public00 
void00 
Put00 
(00 
int00 
id00 
,00 
[00  !
FromBody00! )
]00) *
string00+ 1
value002 7
)007 8
{11 	
}22 	
[55 	

HttpDelete55	 
(55 
$str55 
)55 
]55 
public66 
void66 
Delete66 
(66 
int66 
id66 !
)66! "
{77 	
}88 	
}99 
}:: Ô
3F:\Source\TestJenkins\daiproject\JwtDemo\Program.cs
	namespace 	
JwtDemo
 
{ 
public 

class 
Program 
{ 
public 
static 
void 
Main 
(  
string  &
[& '
]' (
args) -
)- .
{ 	 
CreateWebHostBuilder  
(  !
args! %
)% &
.& '
Build' ,
(, -
)- .
.. /
Run/ 2
(2 3
)3 4
;4 5
} 	
public 
static 
IWebHostBuilder % 
CreateWebHostBuilder& :
(: ;
string; A
[A B
]B C
argsD H
)H I
=>J L
WebHost 
.  
CreateDefaultBuilder (
(( )
args) -
)- .
. 

UseStartup 
< 
Startup #
># $
($ %
)% &
;& '
} 
} ³
3F:\Source\TestJenkins\daiproject\JwtDemo\Startup.cs
	namespace

 	
JwtDemo


 
{ 
public 

class 
Startup 
{ 
private 
char 
[ 
] 
securityKey "
;" #
public 
Startup 
( 
IConfiguration %
configuration& 3
)3 4
{ 	
Configuration 
= 
configuration )
;) *
} 	
public 
IConfiguration 
Configuration +
{, -
get. 1
;1 2
}3 4
public 
void 
ConfigureServices %
(% &
IServiceCollection& 8
services9 A
)A B
{ 	
string 
securityKey 
=  
$str! x
;x y
var  
symmetricSecurityKey $
=% &
new' * 
SymmetricSecurityKey+ ?
(? @
Encoding@ H
.H I
UTF8I M
.M N
GetBytesN V
(V W
securityKeyW b
)b c
)c d
;d e
services 
. 
AddAuthentication &
(& '
JwtBearerDefaults' 8
.8 9 
AuthenticationScheme9 M
)M N
. 
AddJwtBearer 
( 
options %
=>& (
{   
options!! 
.!! %
TokenValidationParameters!! 5
=!!6 7
new!!8 ;%
TokenValidationParameters!!< U
{"" 
ValidateIssuer$$ &
=$$' (
true$$) -
,$$- .
ValidateAudience%% (
=%%) *
true%%+ /
,%%/ 0$
ValidateIssuerSigningKey&& 0
=&&1 2
true&&3 7
,&&7 8
ValidIssuer(( #
=(($ %
$str((& 0
,((0 1
ValidAudience)) %
=))& '
$str))( 1
,))1 2
IssuerSigningKey** (
=**) * 
symmetricSecurityKey**+ ?
}++ 
;++ 
},, 
),, 
;,, 
services-- 
.-- 
AddMvc-- 
(-- 
)-- 
.-- #
SetCompatibilityVersion-- 5
(--5 6 
CompatibilityVersion--6 J
.--J K
Version_2_1--K V
)--V W
;--W X
}.. 	
public11 
void11 
	Configure11 
(11 
IApplicationBuilder11 1
app112 5
,115 6
IHostingEnvironment117 J
env11K N
)11N O
{22 	
if33 
(33 
env33 
.33 
IsDevelopment33 !
(33! "
)33" #
)33# $
{44 
app55 
.55 %
UseDeveloperExceptionPage55 -
(55- .
)55. /
;55/ 0
}66 
app88 
.88 
UseAuthentication88 !
(88! "
)88" #
;88# $
app99 
.99 
UseMvc99 
(99 
)99 
;99 
}:: 	
};; 
}<< 